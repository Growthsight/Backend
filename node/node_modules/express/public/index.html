<!DOCTYPE xhtml PUBLIC "-//W3C//DTD XHTML 4.01//EN">
<html>
<head>
    
    <script   src="https://code.jquery.com/jquery-1.12.3.min.js"   integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ="   crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">



<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>Growthsight</title>
<script type="text/javascript"
  src="http://maps.google.com/maps/api/js?sensor=true"></script>
<style type="text/css">
  *, html { margin:0; padding:0 }
  div#map_canvas { width:100%; height:100%; }
  div#info { width:100%; position:absolute; overflow:hidden; text-align:center; top:0;
    left:0; }
    a {
        color: #FFFFFF;
    }
    
    body{
        background-color: #3FC380;
    }
 .lightBox {
    filter:alpha(opacity=60);
    -moz-opacity:0.6;
    -khtml-opacity: 0.6;
    opacity: 0.6;
    background-color:white;
    padding:2px;
  }
    
    .growthsightTheme {
        color: #FFFFFF;
        background-color: #3FC380;
    }
    
     #map {
        height: 80%;
        width: 100%;
      }
    
    .controls {
        margin-top: 10px;
        border: 1px solid transparent;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        height: 32px;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }

      #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 300px;
      }

      #pac-input:focus {
        border-color: #4d90fe;
      }

      .pac-container {
        font-family: Roboto;
      }

      #type-selector {
        color: #fff;
        background-color: #4d90fe;
        padding: 5px 11px 0px 11px;
      }

      #type-selector label {
        font-family: Roboto;
        font-size: 13px;
        font-weight: 300;
      }
      #target {
        width: 345px;
      }
</style>
    
      <header class="navbar navbar-static-top bs-docs-nav growthsightTheme" id="top" role="banner"> 
        <div class="container"> 
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false"> 
                    <span class="sr-only">Toggle navigation</span> 
                    <span class="icon-bar"></span> 
                    <span class="icon-bar"></span> 
                    <span class="icon-bar"></span> 
                </button> <a href="../" class="navbar-brand">Growthsight</a>
            </div> 
            <nav id="bs-navbar" class="collapse navbar-collapse"> 
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://github.com/Growthsight">About</a></li> 
                    <li><a href="https://github.com/Growthsight">Help</a></li> 
                    <li><a href="https://github.com/Growthsight">Github</a></li> 
                </ul> 
            </nav> 
        </div> 
    </header>
</head>

<body >
  
   <!-- <input id="pac-input" class="controls" type="text" placeholder="Search Box">-->
    <div id="map"></div>
    
        <div id="BTNHolder" style="margin-left:65%;width:300px;gravity:right;margin-top:10px">
                <button id="boxBTN" type="button" class="btn btn-warning">
                  Hide Selection Box
                </button>
                <button id="analyzeBTN" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                  Analyze Selection
                </button>
        </div>
    
    <div id="myModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Confirm Analysis</h4>
      </div>
      <div class="modal-body">
          <p>Are you sure you want to analyze:</p>
          <p id="latHolder">Lat:</p>
          <p id="longHolder">Long:</p>
          </br>
        <p>Email You Want Results To Be Sent To:</p>
        <p><input type="email" class="form-control" id="emailHolder" placeholder="Email"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="analyzeNow">Analyze Now!</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
    
    <script>
        var lat;
        var lon;
      // This example adds a user-editable rectangle to the map.
      // When the user changes the bounds of the rectangle,
      // an info window pops up displaying the new bounds.

      var rectangle;
      var map;
      var infoWindow;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 42.5452, lng: -71.5389},
          zoom: 9
        });

        var bounds = {
          north: 42.5452,
          south: 42.6452,
          east: -71.5389,
          west: -71.6389
        };
           

            sessionStorage.setItem('lat', 42.5452);
            sessionStorage.setItem('lon', -71.5389);
        // Define the rectangle and set its editable property to true.
        rectangle = new google.maps.Rectangle({
          bounds: bounds,
          editable: true,
          draggable: true
        });

        rectangle.setMap(map);

        // Add an event listener on the rectangle.
        rectangle.addListener('bounds_changed', showNewRect);

        // Define an info window on the map.
        infoWindow = new google.maps.InfoWindow();
      }
      // Show the new coordinates for the rectangle in an info window.

      /** @this {google.maps.Rectangle} */
      function showNewRect(event) {
        var ne = rectangle.getBounds().getNorthEast();
        var sw = rectangle.getBounds().getSouthWest();

        var contentString = '<b>Rectangle moved.</b><br>' +
            'New north-east corner: ' + ne.lat() + ', ' + ne.lng() + '<br>' +
            'New south-west corner: ' + sw.lat() + ', ' + sw.lng();
             lat = ne.lat();
            lon=ne.lng();

            sessionStorage.setItem('lat', lat);
            sessionStorage.setItem('lon', lon);
    
          
        // Set the info window's content and position.
        infoWindow.setContent(contentString);
        infoWindow.setPosition(ne);

        infoWindow.open(map);
      }
        
     // Create the search box and link it to the UI element.
  var input = document.getElementById('pac-input');
  /*var searchBox = new google.maps.places.SearchBox(input);
  map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

  // Bias the SearchBox results towards current map's viewport.
  map.addListener('bounds_changed', function() {
    searchBox.setBounds(map.getBounds());
  });

  var markers = [];
  // Listen for the event fired when the user selects a prediction and retrieve
  // more details for that place.
  searchBox.addListener('places_changed', function() {
    var places = searchBox.getPlaces();

    if (places.length == 0) {
      return;
    }

    // Clear out the old markers.
    markers.forEach(function(marker) {
      marker.setMap(null);
    });
    markers = [];

    // For each place, get the icon, name and location.
    var bounds = new google.maps.LatLngBounds();
    places.forEach(function(place) {
      var icon = {
        url: place.icon,
        size: new google.maps.Size(71, 71),
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(17, 34),
        scaledSize: new google.maps.Size(25, 25)
      };

      // Create a marker for each place.
      markers.push(new google.maps.Marker({
        map: map,
        icon: icon,
        title: place.name,
        position: place.geometry.location
      }));
      
      if (place.geometry.viewport) {
        // Only geocodes have viewport.
        bounds.union(place.geometry.viewport);
      } else {
        bounds.extend(place.geometry.location);
      }
    });
    map.fitBounds(bounds);
  });*/
        
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_c3UCAvF5xFeJOziQz7ZJTWFggMjh7u4&callback=initMap">
    </script>
    



    <script>
                // A $( document ).ready() block.
        $( document ).ready(function() {
            
            //Initialize button states
            var boxIsHidden = 1;
            if (boxIsHidden == 1)
                {
                     $( "boxBTN" ).replaceWith( '<button id="boxBTN" type="button" class="btn btn-primary">Show Selection Box</button>');
                     $( "analyzeBTN" ).replaceWith( ' <button id="analyzeBTN" type="button" class="btn">Analyze Selection</button>');
                    boxIsHidden =0;
                }
                else
                {
                     $( "boxBTN" ).replaceWith( '<button id="boxBTN" type="button" class="btn btn-primary">Hide Selection Box</button>');
                     $( "analyzeBTN" ).replaceWith( '<button id="analyzeBTN" type="button" class="btn  btn-primary" data-toggle="modal" data-target="#myModal">Analyze Selection</button>');
                    boxIsHidden =1; 
                }
            
            
            $( "#boxBTN" ).click(function() {
                 if (boxIsHidden == 1)
                {
                      $( "boxBTN" ).replaceWith( '<button id="boxBTN" type="button" class="btn btn-primary">Show Selection Box</button>');
                     $( "analyzeBTN" ).replaceWith( ' <button id="analyzeBTN" type="button" class="btn">Analyze Selection</button>');
                    boxIsHidden =0;
                }
                else
                {
                     $( "boxBTN" ).replaceWith( '<button id="boxBTN" type="button" class="btn btn-primary">Hide Selection Box</button>');
                     $( "analyzeBTN" ).replaceWith( '<button id="analyzeBTN" type="button" class="btn  btn-primary" data-toggle="modal" data-target="#myModal">Analyze Selection</button>');
                    boxIsHidden =1; 
                }
            });
            
            $("#analyzeNow").click(function(){
                
                email = $("#emailHolder").val();
                
                
                if(validateEmail(email))
                {
                    lati=  sessionStorage.getItem('lat');
                    lon = sessionStorage.getItem('lon');
                    
                    var formData = {email:email, lattitude:lati , longitude:lon, usState:"massachusetts"};
                    console.log(formData);
                    $.ajax({
                      url : "http://localhost:8081/analyze/",
                      type: "POST",
                      data : formData,
                      success: function(data, textStatus, jqXHR)
                      {
                          var $modal = $('#myModal');
                          $modal.modal('hide'); //start hiding
                           var json = JSON.parse(data);
                          url = "http://localhost:8081/loading.html";
                          $(location).attr("href", url);

                       
                      },
                      error: function (jqXHR, textStatus, errorThrown)
                      {
                          alert("No Data Available.")
                      }
                    });
                }
                else{
                        alert("Invalid Email Try Again.");
                }
                
            });
            function validateEmail(email) {
                var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }
            $( "#analyzeBTN" ).click(function() {
                
                lati=  sessionStorage.getItem('lat');
                lon = sessionStorage.getItem('lon');
                console.log("1:"+lati+" 2:"+lon);
                latio ="Lattitude = "+lati;
                lono="Longitude = "+lon;
                console.log("1:"+latio+" 2:"+lono);
               $("#longHolder").text(lono);
                $("#latHolder").text(latio);
                

            });
        });
        
        
    </script>
  </body>
</html>
